<!DOCTYPE html>
<html>
<head>
	
	<title>prueba2</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
    <style>
        .c {
            margin: 10px;
            border: 1px solid black;
            width: 300px;
            padding: 10px;
            }
        #mapid {
            width: 600px;
            height: 300px;
        }	
        </style>
<script>

/*

el navegador usa el objeto navigator.geolocation
desde js podemos preguntar la localizacion navigator.geolocation.getCurrentPosition
desde mymap.locate tb podemos preguntar por la localizacion al objeto navigator.geolocation
desde 1) definimos los eventos y desde 2) tambien definimos sus eventos que son diferentes

*/


// ttps://stackoverflow.com/questions/32039568/what-are-the-integrity-and-crossorigin-attributes#32042283
// https://leafletjs.com/examples/quick-start/
// https://docs.mapbox.com/mapbox.js/api/v3.1.1/l-mapbox-map/

function inicio(){

	// boton para dibujar los marcadores
    //CAMBIAR POR HOJITA
	//var ele=document.getElementById('roscaId');
	//ele.onclick=onClickroscaId;

	// crear el mapa
	mymap=L.map('mapid').setView([59.90230405665969, 10.683315948402631], 10); // mymap global
	// solicita localizacion al user , cambio de vista si locate es ok
	mymap.on('locationfound', onLocationFound); 
	mymap.on('locationerror', onLocationError);	
	mymap.locate({setView: true, zoom: 10});
	// respuesta evento de localizacion dentro del mapa


	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        minZoom: 8,
        maxZoom: 10,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11'
	}).addTo(mymap);  // dibujo del mapa de tercero: mapbox

    var greenIcon = L.icon({
    iconUrl: 'leaf-green.png',
    shadowUrl: 'leaf-shadow.png',

    iconSize:     [38, 95], // size of the icon
    shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
    shadowAnchor: [4, 62],  // the same for the shadow
    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
    });
    var marker = L.marker([59.90230405665969, 10.683315948402631], {icon: greenIcon}).addTo(mymap);
    marker.bindPopup("<b>HOLA</b><br>mi marcador").openPopup(); 

    var zoomTXT = document.getElementById("zoom");
    mymap.addEventListener("zoom", function(){
        zoomTXT.value = mymap.getZoom();
        console.log(mymap.getZoom())
    });

    var C1 = document.getElementById("circulo1");
    var circulo1=L.circle([59.90230405665969, 10.683315948402631],50000,{
		color: 'blue',
		fillColor: '#04f',
		fillOpacity: 0.5
	});
    circulo1.setRadius(1000);
    circulo1.bindPopup("circulo1").openPopup();
    C1.addEventListener("click", function(){
        if (C1.checked == true){
        circulo1.addTo(mymap);
    }else{
        circulo1.remove();
    }
    });


    var C2 = document.getElementById("circulo2");
    var circulo2=L.circle([58.90230405665969, 10.683315948402631],50000,{
		color: 'red',
		fillColor: '#f03',
		fillOpacity: 0.5
	});
    circulo2.setRadius(1000);
    circulo2.bindPopup("circulo2").openPopup();

    C2.addEventListener("click", function(){
        if (C2.checked == true){
        circulo2.addTo(mymap);
    }else{
        circulo2.remove();
    }
    });

    var C3 = document.getElementById("cuadrado");
    var cuadrado=L.polygon(polygon([
		[40.4780,-3.7893],
		[40.4780,-4.7893],
		[41.4780,-3.78937],
        [41.4780,-4.7893]
	]));


	// añadir un marcador como objeto de mi js
	//var marker = L.marker([40.4780,-3.7893]).addTo(mymap);

	// añadir un popup al marcador
	//marker.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup(); 

	// anadir evento de click al marcador
	//marker.on('click', onMapClick); // [nota] evento sobre un marcador

	// añadir un circulo 


	// crear un poligono en el mapa
	L.polygon([
		[40.4780,-3.7893],
		[40.4780,-4.7893],
		[41.4780,-3.78937]
	]).addTo(mymap);

}

function onLocationError(e) {
	console.log('leaflet@ locationError');
	//alert(e.message);

	// solicitamos de nuevo la localicazion por js y sus eventos
	navigator.geolocation.getCurrentPosition(
		onPosicion,
		onErrorGeolocating,	{
			enableHighAccuracy: false, // true no hay cambio
			maximumAge:         5000,
			timeout:            10000
	});

}

function onLocationFound(e) {
	var radius = e.accuracy;
	console.log('leaflet@ locationFound');

	// poner marcador
	// ref: https://leafletjs.com/reference-1.6.0.html#marker
	L.marker(e.latlng).addTo(mymap)
	.bindPopup("You are within " + radius + " meters from this point").openPopup();
	// poner circulo
	L.circle(e.latlng, radius).addTo(mymap);

	// solicitamos de nuevo la localicazion por js y sus eventos
	// source: https://developer.mozilla.org/es/docs/Web/API/Geolocation/getCurrentPosition
	// cuidado !! si lo haces junto mymap.on se mezclan los eventos respetar asincronia
	navigator.geolocation.getCurrentPosition(
		onPosicion,
		onErrorGeolocating,	{
			enableHighAccuracy: false, // true no hay cambio
			maximumAge:         5000,
			timeout:            10000
	});
}

function rosca(a){
	// [nota] crear objetos desde js al pulsar un boton
	// crea un circulo (que sufre la proyecciion mercator)
	for (j=0;j<6.2;j+=0.2){
		var x=a*Math.sin(j)/20;
		var y=a*Math.cos(j)/20;
		//console.log(x,y);
		var marker = L.marker([40.4780+x,-3.7893+y]).addTo(mymap);
	}
	// vista del mapa
	mymap.setView([40.4780,-3.7893],11); // posicion y zoom
}
function onMapClick(){
	console.log(this);
	alert('HOLA');
}
function onPosicion(p){
	// el event entra en el parametro p
	console.log('js navigator ok=',p.coords.latitude,p.coords.longitude);
}
function onErrorGeolocating(p){
	// el evento entra en el parametro p
	console.log('js navigator error',p.code);
}

window.onload=inicio;
</script>
	
</head>

<body>
	<div id="mapid"></div>
	<div id="formulario">
        <label for="zoom">Zoom</label><input type="text" name="zoom" id="zoom" class="c" placeholder="zoom"><br>
        <label for="coordenadas">Coordenadas</label><input type="text" name="coordenadas" id="coordenadas" class="c" placeholder="coordenadas"><br>
        <label for="circulo1">circulo 1</label><input type="checkbox" name="circulo1" value="circulo1" id="circulo1"><br>
        <label for="circulo2">circulo 2</label><input type="checkbox" name="circulo2" value="circulo2" id="circulo2"><br>
        <label for="cuadrado">cuadrado</label><input type="checkbox" name="cuadrado" value="cuadrado" id="cuadrado">
    </div>
</body>
</html>